<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMA Social - Checkbox Fix Test</title>
    <link rel="stylesheet" href="backend/static/style.css">
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>BMA Social - Contact Checkbox Test</h1>

        <div class="status success">
            âœ… This is a test page to verify checkbox functionality
        </div>

        <h2>Test Case: Hilton Hotel Contact Selection</h2>

        <div id="test-preview">
            <!-- Will be populated by JavaScript -->
        </div>

        <button onclick="testSelection()" style="margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Test Selection (Check Console)
        </button>
    </div>

    <script>
        // Simulated campaign preview data
        const mockPreview = {
            campaign_id: "test-123",
            type: "renewal",
            plan: {
                campaign_name: "October Renewal Campaign",
                campaign_goal: "Renew contracts expiring in October"
            },
            sample_messages: [
                {
                    customer: "Hilton Bangkok Sukhumvit",
                    brand: "Hilton Hotels & Resorts",
                    zones: ["Lobby", "Restaurant", "Spa"],
                    contacts: [
                        "Rudolf Troestler (General Manager)",
                        "Dennis Leslie (Director of Food & Beverage)"
                    ],
                    contact: "Rudolf Troestler (General Manager), Dennis Leslie (Director of Food & Beverage)",
                    whatsapp: "Hello from BMA Social! Your music contract is expiring soon...",
                    email_subject: "Contract Renewal Reminder",
                    channels: ["whatsapp", "email"]
                },
                {
                    customer: "Marriott Bangkok",
                    brand: "Marriott International",
                    zones: ["Main Lobby", "Pool Area"],
                    contacts: [
                        "Sarah Johnson (GM)",
                        "Mike Chen (Operations Manager)",
                        "Lisa Wong (Marketing Director)"
                    ],
                    contact: "Sarah Johnson (GM), Mike Chen (Operations Manager), Lisa Wong (Marketing Director)",
                    whatsapp: "Hello from BMA Social! Your music contract is expiring soon...",
                    email_subject: "Contract Renewal Reminder",
                    channels: ["whatsapp", "email"]
                }
            ],
            total_customers: 2,
            statistics: {
                total_zones: 5
            }
        };

        // Generate preview HTML with checkboxes
        function generatePreview() {
            let html = '<div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">';

            mockPreview.sample_messages.forEach((sample, customerIndex) => {
                // Get contacts array
                let contacts = [];
                if (sample.contacts && Array.isArray(sample.contacts) && sample.contacts.length > 0) {
                    contacts = sample.contacts.filter(c => c && c.trim() !== '');
                } else if (sample.contact && sample.contact.trim() !== '') {
                    contacts = [sample.contact];
                }

                // Generate checkboxes
                let contactCheckboxes = '';
                contacts.forEach((contact, idx) => {
                    let name = contact.trim();
                    let role = '';
                    if (contact.includes('(') && contact.includes(')')) {
                        const match = contact.match(/(.+)\s*\((.+)\)/);
                        if (match) {
                            name = match[1].trim();
                            role = match[2].trim();
                        }
                    }

                    contactCheckboxes += `
                        <label class="contact-checkbox" style="display: flex; align-items: flex-start; padding: 8px 12px; background: white; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px; cursor: pointer;">
                            <input type="checkbox"
                                   checked
                                   style="margin-right: 10px; margin-top: 2px; width: 18px; height: 18px; cursor: pointer;"
                                   data-customer="${customerIndex}"
                                   data-contact="${idx}"
                                   data-contact-name="${name}"
                                   data-contact-role="${role}"
                                   onchange="console.log('Checkbox changed:', this.checked, '${name}')">
                            <span class="contact-info" style="flex: 1; line-height: 1.4;">
                                <strong style="color: #333; font-weight: 600;">${name}</strong>
                                ${role ? `<br><small style="color: #666; font-size: 0.85rem;">${role}</small>` : ''}
                            </span>
                        </label>
                    `;
                });

                html += `
                    <div style="margin-bottom: 30px; padding: 20px; background: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                        <h3 style="color: #333; margin-bottom: 10px;">${sample.customer}</h3>
                        <p style="color: #666;"><strong>Brand:</strong> ${sample.brand}</p>
                        <p style="color: #666;"><strong>Zones:</strong> ${sample.zones.join(', ')}</p>

                        <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                            <h5 style="margin-bottom: 12px; color: #333; font-size: 1rem;">ðŸ“§ Selected Recipients:</h5>
                            <div style="display: flex; flex-direction: column; gap: 0;">
                                ${contactCheckboxes}
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('test-preview').innerHTML = html;

            // Count checkboxes
            setTimeout(() => {
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                console.log(`âœ… Successfully rendered ${checkboxes.length} checkboxes`);

                // List all checkboxes
                checkboxes.forEach((cb, idx) => {
                    console.log(`Checkbox ${idx + 1}: ${cb.dataset.contactName} (${cb.dataset.contactRole || 'No role'})`);
                });
            }, 100);
        }

        // Test selection function
        function testSelection() {
            const selectedContacts = {};
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
            const checkedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');

            console.log(`\nðŸ“Š Contact Selection Test:`);
            console.log(`Total checkboxes: ${allCheckboxes.length}`);
            console.log(`Selected: ${checkedCheckboxes.length}`);

            checkedCheckboxes.forEach(checkbox => {
                const customerIndex = checkbox.dataset.customer;
                const contactName = checkbox.dataset.contactName;
                const contactRole = checkbox.dataset.contactRole;

                if (!selectedContacts[customerIndex]) {
                    selectedContacts[customerIndex] = [];
                }

                selectedContacts[customerIndex].push({
                    name: contactName,
                    role: contactRole || ''
                });
            });

            console.log('\nSelected contacts by customer:');
            Object.entries(selectedContacts).forEach(([customerId, contacts]) => {
                const customerName = mockPreview.sample_messages[customerId]?.customer || 'Unknown';
                console.log(`\nCustomer ${customerId} (${customerName}):`);
                contacts.forEach(contact => {
                    console.log(`  âœ“ ${contact.name}${contact.role ? ` (${contact.role})` : ''}`);
                });
            });

            alert(`Selected ${checkedCheckboxes.length} of ${allCheckboxes.length} contacts. Check console for details.`);
        }

        // Generate preview on load
        window.addEventListener('DOMContentLoaded', generatePreview);
    </script>
</body>
</html>